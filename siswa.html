// --- BAGIAN LOAD MATERI DI SISWA.HTML ---
async function loadMateriSiswa() {
    const listContainer = document.getElementById('materiList');
    try {
        const q = query(collection(db, "materi"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        let html = "";
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            // Pilih Ikon berdasarkan format
            const icon = (data.format === "video") 
                ? '<i class="fa-brands fa-youtube" style="color:#ff0000; font-size:1.4rem;"></i>' 
                : '<i class="fa-solid fa-file-pdf" style="color:var(--accent-neon); font-size:1.4rem;"></i>';

            html += `
                <div class="materi-card" onclick="viewMateri('${data.link}', '${data.format}')">
                    <div style="display:flex; align-items:center; gap:12px;">
                        ${icon}
                        <div>
                            <div style="font-size:14px; font-weight:700;">${data.judul}</div>
                            <div style="font-size:11px; color:var(--accent-neon); font-weight:bold; opacity:0.8;">${data.jenjang}</div>
                        </div>
                    </div>
                </div>`;
        });
        listContainer.innerHTML = html || "<p>Belum ada materi.</p>";
    } catch (e) {
        listContainer.innerHTML = "<p>Gagal memuat materi.</p>";
    }
}

// --- FUNGSI PREVIEW SISWA ---
window.viewMateri = (url, format) => {
    const preview = document.getElementById('materiPreview');
    preview.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
    
    let embedUrl = "";
    if (format === "video") {
        // Jika video, langsung tampilkan link embed youtube
        embedUrl = url;
    } else {
        // Jika file, gunakan Google Docs Viewer
        embedUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
    }

    setTimeout(() => {
        preview.innerHTML = `<iframe src="${embedUrl}" style="width:100%; height:100%; border:none; background:white;" allowfullscreen></iframe>`;
    }, 500);
};
