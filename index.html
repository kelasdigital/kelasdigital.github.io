<div id="daftarOverlay" class="modal-overlay">
    <div class="modal-box">
        <h2>Create Account</h2>
        <form id="daftarForm">
            <div class="input-group">
                <label class="input-label">DAFTAR SEBAGAI</label>
                <select id="regRole">
                    <option value="siswa">Siswa</option>
                    <option value="guru">Guru</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">JENJANG SEKOLAH</label>
                <select id="regJenjang">
                    <option value="MI">MI (Madrasah Ibtidaiyah)</option>
                    <option value="MTs">MTs (Madrasah Tsanawiyah)</option>
                    <option value="SMA">SMA (Sekolah Menengah Atas)</option>
                </select>
            </div>
            <div class="input-group">
                <label class="input-label">NAMA LENGKAP</label>
                <input type="text" id="regNama" required>
            </div>
            <div class="input-group">
                <label class="input-label">EMAIL</label>
                <input type="email" id="regEmail" required>
            </div>
            <div class="input-group">
                <label class="input-label">PASSWORD</label>
                <input type="password" id="regPass" required>
            </div>
            <button type="submit" class="btn-submit" id="btnRegBtn">Daftar Sekarang</button>
            <span class="btn-close-text" onclick="closeModal()">Tutup</span>
        </form>
    </div>
</div>

<script type="module">
    // ... (Logika Import & Config Firebase tetap sama) ...

    // Update bagian pendaftaran di script:
    document.getElementById('daftarForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnRegBtn');
        btn.innerText = "Creating..."; btn.disabled = true;
        try {
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const cred = await createUserWithEmailAndPassword(auth, email, pass);
            
            // SIMPAN DATA TERMASUK JENJANG
            await setDoc(doc(db, "users", cred.user.uid), { 
                nama: document.getElementById('regNama').value, 
                role: document.getElementById('regRole').value, 
                jenjang: document.getElementById('regJenjang').value, // Simpan Jenjang
                email: email 
            });
            alert("Registrasi Berhasil!"); closeModal();
        } catch (err) { alert(err.message); } finally { btn.innerText = "Daftar Sekarang"; btn.disabled = false; }
    };
</script>
