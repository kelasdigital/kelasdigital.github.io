// Ganti logika load materi di siswa.html dengan ini
import { query, collection, orderBy, onSnapshot, getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
const db = getFirestore();

function loadMateriSiswa(jenjangSiswa) {
    const listContainer = document.getElementById('materiContent');
    const q = query(collection(db, "materi"), orderBy("createdAt", "desc"));
    
    onSnapshot(q, (snapshot) => {
        let html = "";
        snapshot.forEach((doc) => {
            const data = doc.data();
            if (data.jenjang === jenjangSiswa) {
                const icon = (data.format === "video") ? 'fa-brands fa-youtube' : 'fa-solid fa-file-pdf';
                const color = (data.format === "video") ? '#ff0000' : '#00f2ff';

                html += `
                    <div class="materi-card" onclick="viewMateri('${data.link}', '${data.format}')" style="cursor:pointer; margin-bottom:10px; padding:15px; background:rgba(255,255,255,0.05); border-radius:10px; display:flex; align-items:center; gap:15px;">
                        <i class="${icon}" style="color:${color}; font-size:20px;"></i>
                        <div>
                            <div style="font-weight:bold;">${data.judul}</div>
                            <div style="font-size:11px; opacity:0.7;">${data.jenjang}</div>
                        </div>
                    </div>`;
            }
        });
        listContainer.innerHTML = html || "Belum ada materi tersedia untuk jenjang Anda.";
    });
}

// Tambahkan fungsi viewMateri agar bisa membuka PDF dan Video
window.viewMateri = (url, format) => {
    const preview = document.getElementById('materiPreview');
    const finalUrl = (format === "video") ? url : `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
    preview.innerHTML = `<iframe src="${finalUrl}" style="width:100%; height:100%; border:none; background:white;" allowfullscreen></iframe>`;
};
