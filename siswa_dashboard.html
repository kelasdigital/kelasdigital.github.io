<div id="materi" class="content-section">
    <div class="card">
        <h3 style="color: var(--accent-neon); margin-bottom: 20px;">Materi Pembelajaran</h3>
        <div id="materiLayout" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px;">
            <div id="materiList" style="overflow-y: auto; max-height: 500px;">
                <p>Memuat materi...</p>
            </div>
            <div id="materiPreview" style="background: rgba(0,0,0,0.3); border-radius: 15px; height: 550px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                <p style="opacity: 0.5;">Pilih materi untuk dibaca</p>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const db = getFirestore();

    // Fungsi Tampil di Iframe
    window.viewMateri = (url) => {
        const preview = document.getElementById('materiPreview');
        preview.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i>`;
        // Gunakan Google Viewer untuk link GitHub RAW
        const viewerUrl = `https://docs.google.com/viewer?url=${encodeURIComponent(url)}&embedded=true`;
        preview.innerHTML = `<iframe src="${viewerUrl}" style="width:100%; height:100%; border:none; background:white;"></iframe>`;
    };

    // Load Data dari Firestore
    async function loadMateriSiswa() {
        const list = document.getElementById('materiList');
        const snap = await getDocs(query(collection(db, "materi"), orderBy("createdAt", "desc")));
        
        let html = "";
        snap.forEach(res => {
            const d = res.data();
            html += `
                <div class="materi-card" onclick="viewMateri('${d.link}')" style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:10px; cursor:pointer; border:1px solid rgba(255,255,255,0.1);">
                    <div style="font-weight:bold; font-size:14px;">${d.judul}</div>
                    <div style="font-size:11px; color:var(--accent-neon);">${d.jenjang}</div>
                </div>`;
        });
        list.innerHTML = html || "<p>Tidak ada materi.</p>";
    }

    // Panggil saat login sukses
    onAuthStateChanged(auth, (user) => {
        if(user) loadMateriSiswa();
    });
</script>
