<div class="card" style="background: white; color: #333; border-radius: 15px; padding: 25px;">
    <h3 style="color: #2d5a27; margin-bottom: 20px;"><i class="fa-solid fa-cloud-upload"></i> Kelola Materi</h3>
    
    <label>Jenjang Sekolah</label>
    <select id="jenjangMateri" style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd;">
        <option value="MI">MI</option>
        <option value="MTs">MTs</option>
        <option value="SMA">SMA</option>
    </select>

    <label>Judul Materi</label>
    <input type="text" id="judulMateri" placeholder="Masukkan judul..." style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd;">

    <label>Link RAW GitHub (PDF/Gambar)</label>
    <input type="text" id="linkMateri" placeholder="https://raw.githubusercontent.com/..." style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd;">

    <button class="btn-action" id="btnSimpan" onclick="simpanMateri()" style="width: 100%; background: #2d5a27; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
        SIMPAN MATERI
    </button>
</div>

<div class="card" style="background: white; color: #333; margin-top: 20px; border-radius: 15px; padding: 25px;">
    <h4 style="margin-bottom: 15px;">Daftar Materi Terkirim</h4>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="text-align: left; border-bottom: 2px solid #eee;">
                <th style="padding: 10px;">Judul</th>
                <th style="padding: 10px;">Aksi</th>
            </tr>
        </thead>
        <tbody id="tabelMateriBody"></tbody>
    </table>
</div>

<script type="module">
    import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    const db = getFirestore();

    // Simpan Data
    window.simpanMateri = async () => {
        const judul = document.getElementById('judulMateri').value;
        const link = document.getElementById('linkMateri').value;
        const jenjang = document.getElementById('jenjangMateri').value;

        if(!judul || !link) return alert("Isi semua kolom!");

        await addDoc(collection(db, "materi"), {
            judul, link, jenjang, createdAt: serverTimestamp()
        });
        alert("Berhasil!");
        document.getElementById('judulMateri').value = "";
        document.getElementById('linkMateri').value = "";
    };

    // Muat Tabel Real-time
    onSnapshot(query(collection(db, "materi"), orderBy("createdAt", "desc")), (snap) => {
        let html = "";
        snap.forEach(res => {
            const d = res.data();
            html += `<tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">${d.judul} <br><small>${d.jenjang}</small></td>
                <td style="padding: 10px;">
                    <button onclick="hapusMateri('${res.id}')" style="background:red; color:white; border:none; padding:5px; border-radius:4px; cursor:pointer;"><i class="fa-solid fa-trash"></i></button>
                </td>
            </tr>`;
        });
        document.getElementById('tabelMateriBody').innerHTML = html;
    });

    window.hapusMateri = async (id) => {
        if(confirm("Hapus materi?")) await deleteDoc(doc(db, "materi", id));
    };
</script>
